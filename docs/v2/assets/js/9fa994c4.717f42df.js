"use strict";(self.webpackChunkrscg_examples=self.webpackChunkrscg_examples||[]).push([[841],{22778:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>p,toc:()=>d});var a=n(87462),s=(n(67294),n(3905)),i=n(73992),r=n(18679),o=n(68839);const c={sidebar_position:2080,title:"208 - AsyncIt",description:"Generate async from sync or sync from async",slug:"/AsyncIt"},l="AsyncIt  by Oleg Shilo",p={unversionedId:"RSCG-Examples/AsyncIt",id:"RSCG-Examples/AsyncIt",title:"208 - AsyncIt",description:"Generate async from sync or sync from async",source:"@site/docs/RSCG-Examples/AsyncIt.md",sourceDirName:"RSCG-Examples",slug:"/AsyncIt",permalink:"/RSCG_Examples/v2/docs/AsyncIt",draft:!1,tags:[],version:"current",sidebarPosition:2080,frontMatter:{sidebar_position:2080,title:"208 - AsyncIt",description:"Generate async from sync or sync from async",slug:"/AsyncIt"},sidebar:"tutorialSidebar",previous:{title:"207 - AutoInterface",permalink:"/RSCG_Examples/v2/docs/AutoInterface"},next:{title:"209 - ShadowWriterProjectInfo",permalink:"/RSCG_Examples/v2/docs/ShadowWriterProjectInfo"}},m={},d=[{value:"NuGet / site data",id:"nuget--site-data",level:2},{value:"Details",id:"details",level:2},{value:"Info",id:"info",level:3},{value:"Original Readme",id:"original-readme",level:3},{value:"About",id:"about",level:3},{value:"How to use",id:"how-to-use",level:2},{value:"Example (source csproj, source files)",id:"example-source-csproj-source-files",level:3},{value:"Generated Files",id:"generated-files",level:3},{value:"Useful",id:"useful",level:2},{value:"Download Example (.NET  C#)",id:"download-example-net--c",level:3},{value:"Share AsyncIt",id:"share-asyncit",level:3},{value:"In the same category (Async) - 1 other generators",id:"in-the-same-category-async---1-other-generators",level:3},{value:"HsuSgSync",id:"hsusgsync",level:4}],u={toc:d},y="wrapper";function h(e){let{components:t,...c}=e;return(0,s.kt)(y,(0,a.Z)({},u,c,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"asyncit--by-oleg-shilo"},"AsyncIt  by Oleg Shilo"),(0,s.kt)(o.Z,{toc:d,mdxType:"TOCInline"}),(0,s.kt)("h2",{id:"nuget--site-data"},"NuGet / site data"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://www.nuget.org/packages/AsyncIt/"},(0,s.kt)("img",{parentName:"a",src:"https://img.shields.io/nuget/dt/AsyncIt?label=AsyncIt",alt:"Nuget"})),"\n",(0,s.kt)("a",{parentName:"p",href:"https://github.com/oleg-shilo/AsyncIt"},(0,s.kt)("img",{parentName:"a",src:"https://img.shields.io/github/last-commit/oleg-shilo/AsyncIt?label=updated",alt:"GitHub last commit"})),"\n",(0,s.kt)("img",{parentName:"p",src:"https://img.shields.io/github/stars/oleg-shilo/AsyncIt?style=social",alt:"GitHub Repo stars"})),(0,s.kt)("h2",{id:"details"},"Details"),(0,s.kt)("h3",{id:"info"},"Info"),(0,s.kt)("admonition",{type:"info"},(0,s.kt)("p",{parentName:"admonition"},"Name: ",(0,s.kt)("strong",{parentName:"p"},"AsyncIt")),(0,s.kt)("p",{parentName:"admonition"},"AsyncIt is a C# source generator (CodeAnalyzer) for automatic generation of async/sync versions of the type API."),(0,s.kt)("p",{parentName:"admonition"},"Author: Oleg Shilo"),(0,s.kt)("p",{parentName:"admonition"},"NuGet:\n",(0,s.kt)("em",{parentName:"p"},(0,s.kt)("a",{parentName:"em",href:"https://www.nuget.org/packages/AsyncIt/"},"https://www.nuget.org/packages/AsyncIt/")),"   "),(0,s.kt)("p",{parentName:"admonition"},"You can find more details at ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/oleg-shilo/AsyncIt/"},"https://github.com/oleg-shilo/AsyncIt/")),(0,s.kt)("p",{parentName:"admonition"},"Source: ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/oleg-shilo/AsyncIt"},"https://github.com/oleg-shilo/AsyncIt"))),(0,s.kt)("h3",{id:"original-readme"},"Original Readme"),(0,s.kt)("admonition",{type:"note"},(0,s.kt)("h1",{parentName:"admonition",id:"asyncit"},"AsyncIt"),(0,s.kt)("p",{parentName:"admonition"},"AsyncIt is a NuGet package library that allows the automatic generation of additional synchronous and asynchronous APIs for existing user codebase and external packages."),(0,s.kt)("p",{parentName:"admonition"},"It aims to extend user-defined CLR types by automating the otherwise manual process of defining repetitive and straightforward routines. Thus, the development, maintenance and consumption of the released API are simplified due to the balanced (close to ideal) ratio of the synchronous and asynchronous API endpoints:"),(0,s.kt)("p",{parentName:"admonition"},"\xa0","\xa0","\xa0",(0,s.kt)("em",{parentName:"p"},(0,s.kt)("strong",{parentName:"em"},"Every functionality point has both Async and Sync API endpoints available."))),(0,s.kt)("p",{parentName:"admonition"},"This content is an extract from the project's main ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/oleg-shilo/AsyncIt/wiki"},"Wiki page"),". It is highly recommended that you read it, as it explains the deep reasons behind this project and details the more concrete usage scenarios."),(0,s.kt)("h2",{parentName:"admonition",id:"overview"},"Overview"),(0,s.kt)("p",{parentName:"admonition"},'AsyncIt is a source generator that is integrated into the .NET build process as a special tool type - the so-called "Analyzer". It is invoked by the compiler during the assembly build and allows the injection of missing API endpoints based on the present assembly API. Thus, if the assembly being built has the ',(0,s.kt)("inlineCode",{parentName:"p"},"GetStatus")," but not the ",(0,s.kt)("inlineCode",{parentName:"p"},"GetStatusAsync")," method, then AsyncIt will generate the missing method with a straightforward implementation. It can also generate the synchronous API if it is not present in the original codebase:"),(0,s.kt)("ul",{parentName:"admonition"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"The API defines synchronous methods only:"),(0,s.kt)("p",{parentName:"li"},(0,s.kt)("em",{parentName:"p"},"Original code")),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-C#"},"public partial class DeviceLib\n{\n    public static string GetStatus() {. . .}\n}\n")),(0,s.kt)("p",{parentName:"li"},(0,s.kt)("em",{parentName:"p"},"Code that is fed to the C# compiler")),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-C#"},"public partial class DeviceLib\n{\n    public static string GetStatus() {. . .}\n}\n\npublic partial class DeviceLib // AsyncIt generated\n{\n    public static Task<string> GetStatusAsync() \n        => TaskRun(() => GetStatus());\n}\n")))),(0,s.kt)("p",{parentName:"admonition"},"AsyncIt does not do anything fancy. Like the ",(0,s.kt)("inlineCode",{parentName:"p"},"await")," keyword, it cannot magically convert a synchronous routine into an asynchronous one and vice versa. Instead, it simply emits the code that the developer would type manually if he/she decides to use the API in a concurrency way that the API author did not anticipate. "),(0,s.kt)("p",{parentName:"admonition"},"AsyncIt can also be used to balance API of the external assemblies (e.g. .NET base classes, nuget packages)"),(0,s.kt)("p",{parentName:"admonition"},"This is where AsyncIt is placed in the overall .NET concurrency model architecture: "),(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("img",{parentName:"p",src:"https://github.com/oleg-shilo/AsyncIt/assets/16729806/dec186b7-706b-4aee-817b-9e7472c46fc9",alt:"image"})),(0,s.kt)("h2",{parentName:"admonition",id:"usage"},"Usage"),(0,s.kt)("p",{parentName:"admonition"},"In order to integrate AsyncIt with your .NET project, add AsyncIt Nuget package. "),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-ps"},"dotnet add package AsyncIt\n")),(0,s.kt)("p",{parentName:"admonition"},"That's it. Now, you can mark any type for which you want to generate async/sync methods with the ",(0,s.kt)("inlineCode",{parentName:"p"},"[Async]")," attribute (see the details below), and the new source code will be generated and included in the build. "),(0,s.kt)("p",{parentName:"admonition"},"You can always inspect the generated code in the Visual Studio solution explorer:   "),(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("img",{parentName:"p",src:"https://github.com/oleg-shilo/AsyncIt/assets/16729806/fabed4b6-3eec-4421-a293-ed10fad4a950",alt:"image"})),(0,s.kt)("h3",{parentName:"admonition",id:"extending-user-defined-types"},"Extending user-defined types"),(0,s.kt)("p",{parentName:"admonition"},"In this scenario, a user type containing sync/async methods is extended by additional source file(s) implementing additional API methods.\nThe type can be extended either with an additional partial class definition or by the extension methods class."),(0,s.kt)("p",{parentName:"admonition"},"A typical usage can be illustrated by the code below."),(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("em",{parentName:"p"},"Async scenario:")),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-C#"},"[Async]\npublic partial class BankService\n{\n    public partial class OrderService\n    {\n        public Order GetOrder(int id) // and GetOrderAsync will be created by AsyncIt\n        {...}\n    }\n}\n\n...\n\nasync Task OnButtonClick(object sender, EventArgs args)\n{\n    Order order = await service.GetOrderAsync(this.OrderId);\n    orderLabel.Text = order.Name;\n}\n")),(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("em",{parentName:"p"},"Sync scenario:")),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-c#"},'[Async(Interface = Interface.Sync)]\npartial class AccountService\n{\n    public async Task<Account> GetAccountAsync(int id) // and GetAccount will be created by AsyncIt\n    {...}\n}\n\n...\n\nstatic void Main()\n{\n   var account = new AccountService().GetAccount(333);\n   \n   File.WriteAllText($"account_{account.Id}.txt", account.Balance.ToString());\n}\n')),(0,s.kt)("h3",{parentName:"admonition",id:"extending-external-types"},"Extending external types"),(0,s.kt)("p",{parentName:"admonition"},"In this scenario, an external type (from a referenced assembly) containing sync/async methods is extended by additional source file(s) implementing additional API methods.\nThe type can be extended by the extension methods class."),(0,s.kt)("p",{parentName:"admonition"},"A typical usage can be illustrated by the code below for generating on-fly synchronous methods for type ",(0,s.kt)("inlineCode",{parentName:"p"},"HttpClient"),"  ."),(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("em",{parentName:"p"},"Async scenario:")),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-C#"},'// For all synchronous methods of DirectoryInfo will be created an async equivalent by AsyncIt\n[assembly: AsyncExternal(typeof(DirectoryInfo), Interface.Async)] \n\n...\n\nasync Task OnButtonClick(object sender, EventArgs args)\n{\n    var info = new DirectoryInfo(workingDir);\n    \n    string[] folders = await info.GetDirectoriesAsync("*", SearchOption.AllDirectories);\n\n    foreach(var path in folders)\n      foldersListBox.Add(path);\n}\n')),(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("em",{parentName:"p"},"Sync scenario:")),(0,s.kt)("pre",{parentName:"admonition"},(0,s.kt)("code",{parentName:"pre",className:"language-c#"},'// For all asynchronous methods of HttpClient will be created a sync equivalent by AsyncIt\n[assembly: AsyncExternal(typeof(HttpClient), Interface.Sync)];\n\n...\n\nstatic void Main() \n    => File.WriteAllText(\n           "temperature.txt", \n           new HttpClient().GetString("https://www.weather.com/au/melbourne/temperature"));\n'))),(0,s.kt)("h3",{id:"about"},"About"),(0,s.kt)("admonition",{type:"note"},(0,s.kt)("p",{parentName:"admonition"},"Generate async from sync or sync from async")),(0,s.kt)("h2",{id:"how-to-use"},"How to use"),(0,s.kt)("h3",{id:"example-source-csproj-source-files"},"Example (source csproj, source files)"),(0,s.kt)(i.Z,{mdxType:"Tabs"},(0,s.kt)(r.Z,{value:"csproj",label:"CSharp Project",mdxType:"TabItem"},(0,s.kt)("p",null,"This is the CSharp Project that references ",(0,s.kt)("strong",{parentName:"p"},"AsyncIt")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-xml",metastring:"showLineNumbers {16}",showLineNumbers:!0,"{16}":!0},'<Project Sdk="Microsoft.NET.Sdk">\n\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net8.0</TargetFramework>\n    <ImplicitUsings>enable</ImplicitUsings>\n    <Nullable>enable</Nullable>\n  </PropertyGroup>\n\n    <PropertyGroup>\n        <EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>\n        <CompilerGeneratedFilesOutputPath>$(BaseIntermediateOutputPath)\\GX</CompilerGeneratedFilesOutputPath>\n    </PropertyGroup>\n\n    <ItemGroup>\n      <PackageReference Include="AsyncIt" Version="1.0.0-pre4">\n        <PrivateAssets>all</PrivateAssets>\n        <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>\n      </PackageReference>\n    </ItemGroup>\n</Project>\n\n'))),(0,s.kt)(r.Z,{value:"D:\\gth\\RSCG_Examples\\v2\\rscg_examples\\AsyncIt\\src\\ASyncDemo\\Program.cs",label:"Program.cs",mdxType:"TabItem"},(0,s.kt)("p",null,"  This is the use of ",(0,s.kt)("strong",{parentName:"p"},"AsyncIt")," in ",(0,s.kt)("em",{parentName:"p"},"Program.cs")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-csharp",metastring:"showLineNumbers",showLineNumbers:!0},"\nusing AsyncDemo;\n\nvar p=new Person();\nvar result=await p.RunAsync();\nConsole.WriteLine(result);\nresult=p.Run();\nConsole.WriteLine(result);\n\n"))),(0,s.kt)(r.Z,{value:"D:\\gth\\RSCG_Examples\\v2\\rscg_examples\\AsyncIt\\src\\ASyncDemo\\Person.cs",label:"Person.cs",mdxType:"TabItem"},(0,s.kt)("p",null,"  This is the use of ",(0,s.kt)("strong",{parentName:"p"},"AsyncIt")," in ",(0,s.kt)("em",{parentName:"p"},"Person.cs")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-csharp",metastring:"showLineNumbers",showLineNumbers:!0},"using System.ComponentModel;\nnamespace AsyncDemo;\n\n[AsyncIt.Async(Interface = AsyncIt.Interface.Sync)]\ninternal partial class Person\n{   \n    public async Task<bool> RunAsync()\n    {\n        await Task.Delay(1000);\n        return true;\n    }\n}\n\n")))),(0,s.kt)("h3",{id:"generated-files"},"Generated Files"),(0,s.kt)("p",null,"Those are taken from $(BaseIntermediateOutputPath)\\GX"),(0,s.kt)(i.Z,{mdxType:"Tabs"},(0,s.kt)(r.Z,{value:"D:\\gth\\RSCG_Examples\\v2\\rscg_examples\\AsyncIt\\src\\ASyncDemo\\obj\\GX\\AsyncIt\\AsyncIt.AsyncExtensionsGenerator\\AsyncAttribute.g.cs",label:"AsyncAttribute.g.cs",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-csharp",metastring:"showLineNumbers",showLineNumbers:!0},'// <auto-generated/>\n\nusing System;\nusing System.Reflection;\n\nnamespace AsyncIt\n{\n\n    [AttributeUsage(AttributeTargets.Class, AllowMultiple = false)]\n    public class AsyncAttribute : Attribute\n    {\n        public AsyncAttribute()\n        {\n        }\n\n        public AsyncAttribute(Algorithm algorithm, Interface @interface)\n        {\n            Algorithm = algorithm;\n            Interface = @interface;\n        }\n        public AsyncAttribute(Interface @interface, Algorithm algorithm)\n        {\n            Algorithm = algorithm;\n            Interface = @interface;\n        }\n        public AsyncAttribute(Algorithm algorithm)\n        {\n            Algorithm = algorithm;\n        }\n\n        public AsyncAttribute(Interface @interface)\n        {\n            Interface = @interface;\n        }\n        public Algorithm Algorithm { get; set; }\n        public Interface Interface { get; set; }\n        internal string TypeGenericArgs;\n        internal string NamePattern;\n    }\n\n    [AttributeUsage(AttributeTargets.Assembly, AllowMultiple = true, Inherited = false)]\n    public sealed class AsyncExternalAttribute : Attribute\n    {\n        public AsyncExternalAttribute()\n        {\n        }\n        public AsyncExternalAttribute(Type type)\n        {\n            Type = type;\n        }\n\n        public AsyncExternalAttribute(Type type, Interface @interface)\n        {\n            Type = type;\n            Interface = @interface;\n        }\n        public AsyncExternalAttribute(Type type, Interface @interface, string methods)\n        {\n            Type = type;\n            Interface = @interface;\n            Methods = methods;\n        }\n\n        public Interface Interface { get; set; }\n        public Type Type { get; set; }\n        public string Methods { get; set; } = "*";\n    }\n\n    [AttributeUsage(AttributeTargets.Method, AllowMultiple = false)]\n    public class IgnoreAttribute : Attribute\n    {\n    }\n\n    public enum Interface\n    {\n        Async,\n        Sync,\n        Full,\n    }\n\n    public enum Algorithm\n    {\n        PartialType,\n        ExtensionMethods\n    }\n}\n'))),(0,s.kt)(r.Z,{value:"D:\\gth\\RSCG_Examples\\v2\\rscg_examples\\AsyncIt\\src\\ASyncDemo\\obj\\GX\\AsyncIt\\AsyncIt.AsyncExtensionsGenerator\\Person.AsyncDemo.Person.g.cs",label:"Person.AsyncDemo.Person.g.cs",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-csharp",metastring:"showLineNumbers",showLineNumbers:!0},'// <auto-generated/>\nusing System.ComponentModel;\n\nnamespace AsyncDemo\n{\n    internal partial class Person\n    {\n        /// <summary>\n        /// The synchronous version of <see cref="Person.RunAsync()"/>.\n        /// </summary>\n        public bool Run()\n            => RunAsync().Result;\n    }\n}\n')))),(0,s.kt)("h2",{id:"useful"},"Useful"),(0,s.kt)("h3",{id:"download-example-net--c"},"Download Example (.NET  C#)"),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},(0,s.kt)("a",{target:"_blank",href:n(36510).Z},"Download Example project AsyncIt "))),(0,s.kt)("h3",{id:"share-asyncit"},"Share AsyncIt"),(0,s.kt)("ul",null,(0,s.kt)("li",null,(0,s.kt)("a",{href:"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FAsyncIt&quote=AsyncIt",title:"Share on Facebook",target:"_blank"},"Share on Facebook")),(0,s.kt)("li",null,(0,s.kt)("a",{href:"https://twitter.com/intent/tweet?source=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FAsyncIt&text=AsyncIt:%20https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FAsyncIt",target:"_blank",title:"Tweet"},"Share in Twitter")),(0,s.kt)("li",null,(0,s.kt)("a",{href:"http://www.reddit.com/submit?url=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FAsyncIt&title=AsyncIt",target:"_blank",title:"Submit to Reddit"},"Share on Reddit")),(0,s.kt)("li",null,(0,s.kt)("a",{href:"http://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FAsyncIt&title=AsyncIt&summary=&source=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FAsyncIt",target:"_blank",title:"Share on LinkedIn"},"Share on Linkedin"))),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://ignatandrei.github.io/RSCG_Examples/v2/docs/AsyncIt"},"https://ignatandrei.github.io/RSCG_Examples/v2/docs/AsyncIt")),(0,s.kt)("h3",{id:"in-the-same-category-async---1-other-generators"},"In the same category (Async) - 1 other generators"),(0,s.kt)("h4",{id:"hsusgsync"},(0,s.kt)("a",{parentName:"h4",href:"/docs/HsuSgSync"},"HsuSgSync")))}h.isMDXComponent=!0},36510:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/files/AsyncIt-2b210dc9fa999e8e2af43a5123d90d53.zip"}}]);