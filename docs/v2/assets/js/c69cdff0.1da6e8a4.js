"use strict";(self.webpackChunkrscg_examples=self.webpackChunkrscg_examples||[]).push([[176],{4137:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>g});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var c=n.createContext({}),o=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},p=function(e){var t=o(e.components);return n.createElement(c.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=o(r),m=a,g=d["".concat(c,".").concat(m)]||d[m]||u[m]||i;return r?n.createElement(g,l(l({ref:t},p),{},{components:r})):n.createElement(g,l({ref:t},p))}));function g(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,l=new Array(i);l[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[d]="string"==typeof e?e:a,l[1]=s;for(var o=2;o<i;o++)l[o]=r[o];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},2314:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>o});var n=r(7462),a=(r(7294),r(4137));const i={},l="Injectio",s={unversionedId:"RSCG-Examples/Injectio_readme",id:"RSCG-Examples/Injectio_readme",title:"Injectio",description:"Source generator that helps register attribute marked services in the dependency injection ServiceCollection",source:"@site/docs/RSCG-Examples/Injectio_readme.md",sourceDirName:"RSCG-Examples",slug:"/RSCG-Examples/Injectio_readme",permalink:"/RSCG_Examples/v2/docs/RSCG-Examples/Injectio_readme",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Immutype",permalink:"/RSCG_Examples/v2/docs/RSCG-Examples/Immutype_readme"},next:{title:"Lombok.NET",permalink:"/RSCG_Examples/v2/docs/RSCG-Examples/Lombok.NET_readme"}},c={},o=[{value:"Features",id:"features",level:2},{value:"Usage",id:"usage",level:3},{value:"Add package",id:"add-package",level:4},{value:"Registration Attributes",id:"registration-attributes",level:3},{value:"Attribute Properties",id:"attribute-properties",level:4},{value:"Duplicate Strategy",id:"duplicate-strategy",level:4},{value:"Registration Strategy",id:"registration-strategy",level:4},{value:"Singleton services",id:"singleton-services",level:4},{value:"Scoped Services",id:"scoped-services",level:4},{value:"Transient Services",id:"transient-services",level:4},{value:"Factories",id:"factories",level:4},{value:"Generic Attributes",id:"generic-attributes",level:4},{value:"Open Generic",id:"open-generic",level:4},{value:"Register Method",id:"register-method",level:4},{value:"Add to container",id:"add-to-container",level:4},{value:"Registration Tags",id:"registration-tags",level:4}],p={toc:o},d="wrapper";function u(e){let{components:t,...r}=e;return(0,a.kt)(d,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"injectio"},"Injectio"),(0,a.kt)("p",null,"Source generator that helps register attribute marked services in the dependency injection ServiceCollection"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/loresoft/Injectio"},(0,a.kt)("img",{parentName:"a",src:"https://raw.githubusercontent.com/loresoft/Injectio/main/media/Injectio.Genertors.png",alt:"Source generator"}))),(0,a.kt)("h2",{id:"features"},"Features"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Transient, Singleton, Scoped service registration"),(0,a.kt)("li",{parentName:"ul"},"Factory registration"),(0,a.kt)("li",{parentName:"ul"},"Module method registration"),(0,a.kt)("li",{parentName:"ul"},"Duplicate Strategy - Skip,Replace,Append"),(0,a.kt)("li",{parentName:"ul"},"Registration Strategy - Self, Implemented Interfaces, Self With Interfaces")),(0,a.kt)("h3",{id:"usage"},"Usage"),(0,a.kt)("h4",{id:"add-package"},"Add package"),(0,a.kt)("p",null,"Add the nuget package project to your projects."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"dotnet add package Injectio")),(0,a.kt)("p",null,"Prevent dependances from including Injectio"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},'<PackageReference Include="Injectio" PrivateAssets="all" />\n')),(0,a.kt)("h3",{id:"registration-attributes"},"Registration Attributes"),(0,a.kt)("p",null,"Place registration attribute on class.  The class will be discovered and registered."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"[RegisterSingleton]")," Marks the class as a singleton service"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"[RegisterScoped]")," Marks the class as a scoped service"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"[RegisterTransient]")," Marks the class as a transient service"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"[RegisterServices]")," Marks the method to be called to register services")),(0,a.kt)("h4",{id:"attribute-properties"},"Attribute Properties"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Property"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"ImplementationType"),(0,a.kt)("td",{parentName:"tr",align:null},"The type that implements the service.  If not set, the class the attribute is on will be used.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"ServiceType"),(0,a.kt)("td",{parentName:"tr",align:null},"The type of the service. If not set, the Registration property used to determine what is registered.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Factory"),(0,a.kt)("td",{parentName:"tr",align:null},"Name of a factory method to create new instances of the service implementation.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Duplicate"),(0,a.kt)("td",{parentName:"tr",align:null},"How the generator handles duplicate registrations. See Duplicate Strategy")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Registration"),(0,a.kt)("td",{parentName:"tr",align:null},"How the generator determines what to register. See Registration Strategy")))),(0,a.kt)("h4",{id:"duplicate-strategy"},"Duplicate Strategy"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Skip"),(0,a.kt)("td",{parentName:"tr",align:null},"Skips registrations for services that already exists")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Replace"),(0,a.kt)("td",{parentName:"tr",align:null},"Replaces existing service registrations")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Append"),(0,a.kt)("td",{parentName:"tr",align:null},"Appends a new registration for existing services")))),(0,a.kt)("h4",{id:"registration-strategy"},"Registration Strategy"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Self"),(0,a.kt)("td",{parentName:"tr",align:null},"Registers each matching concrete type as itself")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"ImplementedInterfaces"),(0,a.kt)("td",{parentName:"tr",align:null},"Registers each matching concrete type as all of its implemented interfaces")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"SelfWithInterfaces"),(0,a.kt)("td",{parentName:"tr",align:null},"Registers each matching concrete type as all of its implemented interfaces and itself")))),(0,a.kt)("h4",{id:"singleton-services"},"Singleton services"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"[RegisterSingleton]\npublic class SingletonService : IService { }\n")),(0,a.kt)("p",null,"Explicit service type"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"[RegisterSingleton(ServiceType = typeof(IService))]\npublic class SingletonService : IService { }\n")),(0,a.kt)("p",null,"Support resolving multiple services with ",(0,a.kt)("inlineCode",{parentName:"p"},"IEnumerable<T>")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"[RegisterSingleton(Duplicate = DuplicateStrategy.Append)]\npublic class SingletonService : IService { }\n")),(0,a.kt)("h4",{id:"scoped-services"},"Scoped Services"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"[RegisterScoped]\npublic class ScopedService : IService { }\n")),(0,a.kt)("h4",{id:"transient-services"},"Transient Services"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"[RegisterTransient]\npublic class TransientService : IService { }\n")),(0,a.kt)("h4",{id:"factories"},"Factories"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"[RegisterTransient(Factory = nameof(ServiceFactory))]\npublic class FactoryService : IFactoryService\n{\n    private readonly IService _service;\n\n    public FactoryService(IService service)\n    { \n        _service = service;\n    }\n\n    public static IFactoryService ServiceFactory(IServiceProvider serviceProvider)\n    {\n        return new FactoryService(serviceProvider.GetService<IService>());\n    }\n}\n")),(0,a.kt)("h4",{id:"generic-attributes"},"Generic Attributes"),(0,a.kt)("p",null,"You can use generic attributes to register services if your project targets net7.0."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},'<Project Sdk="Microsoft.NET.Sdk">\n  <PropertyGroup>\n    <TargetFrameworks>net7.0</TargetFrameworks>\n  </PropertyGroup>\n</Project>\n')),(0,a.kt)("p",null,"Generic attributes allow declaration to be more compact by avoiding the typeof calls"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"[RegisterSingleton<IService>]\npublic class ServiceImplementation : IService { }\n")),(0,a.kt)("h4",{id:"open-generic"},"Open Generic"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"[RegisterSingleton(ImplementationType = typeof(OpenGeneric<>), ServiceType = typeof(IOpenGeneric<>))]\npublic class OpenGeneric<T> : IOpenGeneric<T> { }\n")),(0,a.kt)("h4",{id:"register-method"},"Register Method"),(0,a.kt)("p",null,"When the service registration is complex, use the ",(0,a.kt)("inlineCode",{parentName:"p"},"RegisterServices")," attribute on a method that has a parameter of ",(0,a.kt)("inlineCode",{parentName:"p"},"IServiceCollection")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"ServiceCollection")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"public class RegistrationModule\n{\n    [RegisterServices]\n    public static void Register(IServiceCollection services)\n    {\n        services.TryAddTransient<IModuleService, ModuleService>();\n    }\n}\n")),(0,a.kt)("h4",{id:"add-to-container"},"Add to container"),(0,a.kt)("p",null,"The source generator creates an extension method with all the discovered services registered.  Call the generated extension method to add the services to the container.  The extension method will be called ",(0,a.kt)("inlineCode",{parentName:"p"},"Add[AssemblyName]"),".  The assembly name will have the dots removed."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"var services = new ServiceCollection();\nservices.AddInjectioTestsConsole();\n")),(0,a.kt)("p",null,"Override the extension method name by using the ",(0,a.kt)("inlineCode",{parentName:"p"},"InjectioName")," MSBuild property."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},"<PropertyGroup>\n  <InjectioName>Library</InjectioName>\n</PropertyGroup>\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},"var services = new ServiceCollection();\nservices.AddLibrary();\n")),(0,a.kt)("h4",{id:"registration-tags"},"Registration Tags"),(0,a.kt)("p",null,"Control what is registered when calling the generated extension method using Tags"),(0,a.kt)("p",null,"Tag the service"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},'public interface IServiceTag\n{\n}\n\n[RegisterSingleton(Tags = "Client,FrontEnd")]\npublic class ServiceTag : IServiceTag\n{\n}\n')),(0,a.kt)("p",null,"Specify tags when adding to service collection.  Note, if no tags specified, all services are registered"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-c#"},'var services = new ServiceCollection();\nservices.AddInjectioTestsLibrary("Client");\n')))}u.isMDXComponent=!0}}]);