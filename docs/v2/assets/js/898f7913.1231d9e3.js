"use strict";(self.webpackChunkrscg_examples=self.webpackChunkrscg_examples||[]).push([[6074],{55777:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>m,contentTitle:()=>l,default:()=>g,frontMatter:()=>p,metadata:()=>u,toc:()=>c});var r=a(87462),o=(a(67294),a(3905)),n=a(73992),i=a(18679),s=a(68839);const p={sidebar_position:610,title:"61 - ProtobufSourceGenerator",description:"Serializing a class to protobuf",slug:"/ProtobufSourceGenerator"},l="ProtobufSourceGenerator  by Laszlo Deak",u={unversionedId:"RSCG-Examples/ProtobufSourceGenerator",id:"RSCG-Examples/ProtobufSourceGenerator",title:"61 - ProtobufSourceGenerator",description:"Serializing a class to protobuf",source:"@site/docs/RSCG-Examples/ProtobufSourceGenerator.md",sourceDirName:"RSCG-Examples",slug:"/ProtobufSourceGenerator",permalink:"/RSCG_Examples/v2/docs/ProtobufSourceGenerator",draft:!1,tags:[],version:"current",sidebarPosition:610,frontMatter:{sidebar_position:610,title:"61 - ProtobufSourceGenerator",description:"Serializing a class to protobuf",slug:"/ProtobufSourceGenerator"},sidebar:"tutorialSidebar",previous:{title:"60 - SafeRouting",permalink:"/RSCG_Examples/v2/docs/SafeRouting"},next:{title:"62 - RSCG_Decorator",permalink:"/RSCG_Examples/v2/docs/RSCG_Decorator"}},m={},c=[{value:"Nuget / site data",id:"nuget--site-data",level:2},{value:"Details",id:"details",level:2},{value:"Info",id:"info",level:3},{value:"Original Readme",id:"original-readme",level:3},{value:"About",id:"about",level:3},{value:"How to use",id:"how-to-use",level:2},{value:"Example ( source csproj, source files )",id:"example--source-csproj-source-files-",level:3},{value:"Generated Files",id:"generated-files",level:3},{value:"Usefull",id:"usefull",level:2},{value:"Download Example (.NET  C# )",id:"download-example-net--c-",level:3},{value:"Share ProtobufSourceGenerator",id:"share-protobufsourcegenerator",level:3},{value:"In the same category (Serializer) - 4 other generators",id:"in-the-same-category-serializer---4-other-generators",level:3},{value:"GenPack",id:"genpack",level:4},{value:"jsonConverterSourceGenerator",id:"jsonconvertersourcegenerator",level:4},{value:"JsonPolymorphicGenerator",id:"jsonpolymorphicgenerator",level:4},{value:"System.Text.Json",id:"systemtextjson",level:4}],d={toc:c},h="wrapper";function g(e){let{components:t,...p}=e;return(0,o.kt)(h,(0,r.Z)({},d,p,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"protobufsourcegenerator--by-laszlo-deak"},"ProtobufSourceGenerator  by Laszlo Deak"),(0,o.kt)(s.Z,{toc:c,mdxType:"TOCInline"}),(0,o.kt)("h2",{id:"nuget--site-data"},"Nuget / site data"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.nuget.org/packages/LaDeak.ProtobufSourceGenerator/"},(0,o.kt)("img",{parentName:"a",src:"https://img.shields.io/nuget/dt/LaDeak.ProtobufSourceGenerator?label=LaDeak.ProtobufSourceGenerator",alt:"Nuget"})),"\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ladeak/ProtobufSourceGenerator"},(0,o.kt)("img",{parentName:"a",src:"https://img.shields.io/github/last-commit/ladeak/ProtobufSourceGenerator?label=updated",alt:"GitHub last commit"})),"\n",(0,o.kt)("img",{parentName:"p",src:"https://img.shields.io/github/stars/ladeak/ProtobufSourceGenerator?style=social",alt:"GitHub Repo stars"})),(0,o.kt)("h2",{id:"details"},"Details"),(0,o.kt)("h3",{id:"info"},"Info"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Name: ",(0,o.kt)("strong",{parentName:"p"},"ProtobufSourceGenerator")),(0,o.kt)("p",{parentName:"admonition"},"A source generator that generates helper classes with properties attributes with ProtoMember attribute."),(0,o.kt)("p",{parentName:"admonition"},"Author: Laszlo Deak"),(0,o.kt)("p",{parentName:"admonition"},"NuGet:\n",(0,o.kt)("em",{parentName:"p"},(0,o.kt)("a",{parentName:"em",href:"https://www.nuget.org/packages/LaDeak.ProtobufSourceGenerator/"},"https://www.nuget.org/packages/LaDeak.ProtobufSourceGenerator/")),"   "),(0,o.kt)("p",{parentName:"admonition"},"You can find more details at ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ladeak/ProtobufSourceGenerator"},"https://github.com/ladeak/ProtobufSourceGenerator")),(0,o.kt)("p",{parentName:"admonition"},"Source : ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ladeak/ProtobufSourceGenerator"},"https://github.com/ladeak/ProtobufSourceGenerator"))),(0,o.kt)("h3",{id:"original-readme"},"Original Readme"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("h1",{parentName:"admonition",id:"protobuf-source-generator"},"Protobuf Source Generator"),(0,o.kt)("p",{parentName:"admonition"},"A source generator that generates partial helper classes where member properties are attributed with ProtoMember attribute for serialization with ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/protobuf-net/protobuf-net"},"protobuf-net"),"."),(0,o.kt)("h2",{parentName:"admonition",id:"getting-started"},"Getting Started"),(0,o.kt)("p",{parentName:"admonition"},"Install nuget package:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"dotnet add package LaDeak.ProtobufSourceGenerator\n")),(0,o.kt)("p",{parentName:"admonition"},"The source generator creates partial classes with ",(0,o.kt)("em",{parentName:"p"},"private")," properties that are attributed with ",(0,o.kt)("inlineCode",{parentName:"p"},"[ProtoMember]")," attributes. The properties ",(0,o.kt)("em",{parentName:"p"},"get")," and ",(0,o.kt)("em",{parentName:"p"},"set")," a corresponding property from the source type. This way developers are free to add and remove properties without explicitly attributing them."),(0,o.kt)("blockquote",{parentName:"admonition"},(0,o.kt)("p",{parentName:"blockquote"},"Note that adding, removing or reordering properties might cause breaking changes for the serialized data, as the tags assigned with ",(0,o.kt)("inlineCode",{parentName:"p"},"[ProtoMember]")," attribute are given based on the source type's definition.")),(0,o.kt)("p",{parentName:"admonition"},"To generate a partial type for a custom type, mark the type with ",(0,o.kt)("inlineCode",{parentName:"p"},"[ProtoContract]")," attribute and with ",(0,o.kt)("inlineCode",{parentName:"p"},"partial")," modifier. For example, the following entity type can be made source generating:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"public class Entity\n{\n    public int Id { get; set; }\n}\n")),(0,o.kt)("p",{parentName:"admonition"},"Add ",(0,o.kt)("inlineCode",{parentName:"p"},"[ProtoContract]")," attribute and ",(0,o.kt)("inlineCode",{parentName:"p"},"partial")," modifier on the type definition:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"[ProtoContract]\npublic partial class Entity\n{\n    public int Id { get; set; }\n}\n")),(0,o.kt)("p",{parentName:"admonition"},"With this change a corresponding partial type is generated, that can be used for serialization with ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/protobuf-net/protobuf-net"},"protobuf-net"),":"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"#nullable enable\nnamespace SampleApp;\npublic partial class Entity\n{\n    [ProtoBuf.ProtoMember(1)]\n    private int ProtoId { get => Id; set => Id = value; }\n}\n")),(0,o.kt)("p",{parentName:"admonition"},"The source generator generates serializable properties that are auto properties with getter and setters. "),(0,o.kt)("h2",{parentName:"admonition",id:"non-generating-properties"},"Non-Generating Properties"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"init")," properties are excluded from source generation"),(0,o.kt)("li",{parentName:"ul"},"Non-auto properties are not generated"),(0,o.kt)("li",{parentName:"ul"},"Properties marked with ",(0,o.kt)("inlineCode",{parentName:"li"},"[ProtoIgnore]")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"[ProtoMemeber(x)]")," attributes are not generated."),(0,o.kt)("li",{parentName:"ul"},"Positional Records (not supported by protobuf-net)")),(0,o.kt)("p",{parentName:"admonition"},"In case a property needs to be serialized, but it has no corresponding generated property, it may be attributed with ",(0,o.kt)("inlineCode",{parentName:"p"},"[ProtoMemeber(x)]")," on the original type. The source generator makes sure that tag ",(0,o.kt)("em",{parentName:"p"},"x")," is not used on the generated partial type."),(0,o.kt)("h2",{parentName:"admonition",id:"nested-types"},"Nested Types"),(0,o.kt)("p",{parentName:"admonition"},"Generating partial types for nested types is supported, however parent types must be marked with ",(0,o.kt)("em",{parentName:"p"},"partial")," modifier."),(0,o.kt)("h2",{parentName:"admonition",id:"analyzer"},"Analyzer"),(0,o.kt)("p",{parentName:"admonition"},"The source generator also comes with an analyzer helping source generation:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"issues an error if a custom type of a property is not participating in source generation"),(0,o.kt)("li",{parentName:"ul"},"issues an error if a source generated nested type's parent is not partial"),(0,o.kt)("li",{parentName:"ul"},"issues an info if a property is not part of source generation"),(0,o.kt)("li",{parentName:"ul"},"issues a warning when the base type is not attributed for serialization")),(0,o.kt)("h2",{parentName:"admonition",id:"advanced-usage"},"Advanced Usage"),(0,o.kt)("h3",{parentName:"admonition",id:"null-items-in-collections"},"Null Items in Collections"),(0,o.kt)("p",{parentName:"admonition"},"Serializing null values by protobuf-net is not allowed:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'new List<string>() { "one", null, "three" };\n')),(0,o.kt)("p",{parentName:"admonition"},"The generator will not remove null items, so in this case an exception shall be handled by the user code."),(0,o.kt)("h3",{parentName:"admonition",id:"empty-collections"},"Empty Collections"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"public List<string> Value { get; set; }\n")),(0,o.kt)("p",{parentName:"admonition"},"Empty lists are not distinguished by the proto contract from a null lists. protobuf-net suggests to have an additional ",(0,o.kt)("inlineCode",{parentName:"p"},"bool")," property indicating if the list was empty at serialization or not, and based on the value instantiate a collection at deserialization or not."),(0,o.kt)("p",{parentName:"admonition"},"ProtoBufGenearator generates the helper property such as:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"[global::ProtoBuf.ProtoMember(1)]\nprivate System.Collections.Generic.List<string> ProtoValue { get => Value; set => Value = value; }\n\n[global::ProtoBuf.ProtoMember(2)]\n[global::System.ComponentModel.DataAnnotations.Schema.NotMappedAttribute]\nprivate bool ProtoIsEmptyValue\n{\n    get => ProtoValue?.Count == 0;\n    set\n    {\n        if (value)\n            ProtoValue = new();\n    }\n}\n")),(0,o.kt)("h3",{parentName:"admonition",id:"initialized-to-enumerable-empty"},"Initialized to Enumerable Empty"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"public IEnumerable<string> Values { get; set; } = Enumerable.Empty<string>();\n")),(0,o.kt)("p",{parentName:"admonition"},"Collections when initialized with enumerable empty cause an issue with deserialization as protobuf-net will attempt to add an item to the existing collection, which is not possible in the above case."),(0,o.kt)("p",{parentName:"admonition"},"In this case the user may initialze with an empty list, or manually decorate the property with ",(0,o.kt)("inlineCode",{parentName:"p"},"[ProtoMember()]")," (or ",(0,o.kt)("inlineCode",{parentName:"p"},"[ProtoIgnore]"),") attribute that will exclude it from protobuf source generation."),(0,o.kt)("h3",{parentName:"admonition",id:"custom-attributes-on-properties"},"Custom Attributes on Properties"),(0,o.kt)("p",{parentName:"admonition"},"It is supported to decorate all properties in the generated partial class with custom attributes."),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"[ProtoContract]\n[GeneratorOptions(PropertyAttributeType = typeof(NotMappedAttribute))]\npublic partial class CustomAttributedEntity\n{\n    // ...\n}\n")),(0,o.kt)("p",{parentName:"admonition"},"In the above example, with the type parameter of ",(0,o.kt)("inlineCode",{parentName:"p"},"GeneratorOptions")," the generator is instructed to apply ",(0,o.kt)("inlineCode",{parentName:"p"},"NotMappedAttribute")," attribute on all generated properties on a class."),(0,o.kt)("p",{parentName:"admonition"},"For a more fine grained approach consider excluding the given property from the source generation. For such cases use ",(0,o.kt)("inlineCode",{parentName:"p"},"[ProtoMember()]")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"[ProtoIgnore]")," attributes."),(0,o.kt)("h3",{parentName:"admonition",id:"base-classes-and-inheritance"},"Base Classes and Inheritance"),(0,o.kt)("p",{parentName:"admonition"},"Follow the instructions of protobuf-net library. Apply ",(0,o.kt)("inlineCode",{parentName:"p"},"[ProtoInclude(...)]")," attribute on the type definition.")),(0,o.kt)("h3",{id:"about"},"About"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Serializing a class to protobuf")),(0,o.kt)("h2",{id:"how-to-use"},"How to use"),(0,o.kt)("h3",{id:"example--source-csproj-source-files-"},"Example ( source csproj, source files )"),(0,o.kt)(n.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"csproj",label:"CSharp Project",mdxType:"TabItem"},(0,o.kt)("p",null,"This is the CSharp Project that references ",(0,o.kt)("strong",{parentName:"p"},"ProtobufSourceGenerator")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml",metastring:"showLineNumbers {10}",showLineNumbers:!0,"{10}":!0},'<Project Sdk="Microsoft.NET.Sdk">\n\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net7.0</TargetFramework>\n    <ImplicitUsings>enable</ImplicitUsings>\n    <Nullable>enable</Nullable>\n  </PropertyGroup>\n    <ItemGroup>\n        <PackageReference Include="LaDeak.ProtobufSourceGenerator" Version="1.5.1" OutputItemType="Analyzer" ReferenceOutputAssembly="true" />\n        <PackageReference Include="protobuf-net" Version="3.2.26" />\n    </ItemGroup>\n    <PropertyGroup>\n        <EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>\n        <CompilerGeneratedFilesOutputPath>$(BaseIntermediateOutputPath)\\GX</CompilerGeneratedFilesOutputPath>\n    </PropertyGroup>\n</Project>\n\n'))),(0,o.kt)(i.Z,{value:"D:\\gth\\RSCG_Examples\\v2\\rscg_examples\\ProtobufSourceGenerator\\src\\ProtobufSourceGeneratorDemo\\Program.cs",label:"Program.cs",mdxType:"TabItem"},(0,o.kt)("p",null,"  This is the use of ",(0,o.kt)("strong",{parentName:"p"},"ProtobufSourceGenerator")," in ",(0,o.kt)("em",{parentName:"p"},"Program.cs")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp",metastring:"showLineNumbers",showLineNumbers:!0},'using ProtoBuf;\nusing ProtobufSourceGeneratorDemo;\n\nusing var ms = new MemoryStream();\nSerializer.Serialize(ms, new Person() { Name= "Andrei Ignat" });\nms.Seek(0, SeekOrigin.Begin);\nvar entity = Serializer.Deserialize<Person>(ms);\nConsole.WriteLine("name is "+entity.Name);\n'))),(0,o.kt)(i.Z,{value:"D:\\gth\\RSCG_Examples\\v2\\rscg_examples\\ProtobufSourceGenerator\\src\\ProtobufSourceGeneratorDemo\\Person.cs",label:"Person.cs",mdxType:"TabItem"},(0,o.kt)("p",null,"  This is the use of ",(0,o.kt)("strong",{parentName:"p"},"ProtobufSourceGenerator")," in ",(0,o.kt)("em",{parentName:"p"},"Person.cs")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp",metastring:"showLineNumbers",showLineNumbers:!0},"using ProtoBuf;\n\nnamespace ProtobufSourceGeneratorDemo;\n\n[ProtoContract]\npublic partial class Person\n{\n    \n    public int Id { get; set; }\n    public string? Name { get; set; }\n}\n\n\n")))),(0,o.kt)("h3",{id:"generated-files"},"Generated Files"),(0,o.kt)("p",null,"Those are taken from $(BaseIntermediateOutputPath)\\GX"),(0,o.kt)(n.Z,{mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"D:\\gth\\RSCG_Examples\\v2\\rscg_examples\\ProtobufSourceGenerator\\src\\ProtobufSourceGeneratorDemo\\obj\\GX\\ProtobufSourceGenerator\\ProtobufSourceGenerator.Incremental.IncrementalSourceGenerator\\ProtoPerson.g.cs",label:"ProtoPerson.g.cs",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp",metastring:"showLineNumbers",showLineNumbers:!0},"// <auto-generated/>\n#nullable enable\nnamespace ProtobufSourceGeneratorDemo;\n[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]\npublic partial class Person\n{\n    [global::ProtoBuf.ProtoMember(1)]\n    private int ProtoId { get => Id; set => Id = value; }\n\n    [global::ProtoBuf.ProtoMember(2)]\n    private string? ProtoName { get => Name; set => Name = value; }\n}\n")))),(0,o.kt)("h2",{id:"usefull"},"Usefull"),(0,o.kt)("h3",{id:"download-example-net--c-"},"Download Example (.NET  C# )"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("a",{target:"_blank",href:a(71752).Z},"Download Example project ProtobufSourceGenerator "))),(0,o.kt)("h3",{id:"share-protobufsourcegenerator"},"Share ProtobufSourceGenerator"),(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FProtobufSourceGenerator&quote=ProtobufSourceGenerator",title:"Share on Facebook",target:"_blank"},"Share on Facebook")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://twitter.com/intent/tweet?source=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FProtobufSourceGenerator&text=ProtobufSourceGenerator:%20https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FProtobufSourceGenerator",target:"_blank",title:"Tweet"},"Share in Twitter")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"http://www.reddit.com/submit?url=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FProtobufSourceGenerator&title=ProtobufSourceGenerator",target:"_blank",title:"Submit to Reddit"},"Share on Reddit")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"http://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FProtobufSourceGenerator&title=ProtobufSourceGenerator&summary=&source=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FProtobufSourceGenerator",target:"_blank",title:"Share on LinkedIn"},"Share on Linkedin"))),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://ignatandrei.github.io/RSCG_Examples/v2/docs/ProtobufSourceGenerator"},"https://ignatandrei.github.io/RSCG_Examples/v2/docs/ProtobufSourceGenerator")),(0,o.kt)("h3",{id:"in-the-same-category-serializer---4-other-generators"},"In the same category (Serializer) - 4 other generators"),(0,o.kt)("h4",{id:"genpack"},(0,o.kt)("a",{parentName:"h4",href:"/docs/GenPack"},"GenPack")),(0,o.kt)("h4",{id:"jsonconvertersourcegenerator"},(0,o.kt)("a",{parentName:"h4",href:"/docs/jsonConverterSourceGenerator"},"jsonConverterSourceGenerator")),(0,o.kt)("h4",{id:"jsonpolymorphicgenerator"},(0,o.kt)("a",{parentName:"h4",href:"/docs/JsonPolymorphicGenerator"},"JsonPolymorphicGenerator")),(0,o.kt)("h4",{id:"systemtextjson"},(0,o.kt)("a",{parentName:"h4",href:"/docs/System.Text.Json"},"System.Text.Json")))}g.isMDXComponent=!0},71752:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/files/ProtobufSourceGenerator-225fce147d9395525efbe3a068efc117.zip"}}]);