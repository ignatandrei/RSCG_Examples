---
sidebar_position: 1690
title: 169 - GenPack
description: Generating Binary Serialization and properties for class
slug: /GenPack
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import TOCInline from '@theme/TOCInline';
import SameCategory from '../Categories/_PrimitiveSerializer.mdx';

# GenPack  by dimohy


<TOCInline toc={toc}  />

## NuGet / site data
[![Nuget](https://img.shields.io/nuget/dt/GenPack?label=GenPack)](https://www.nuget.org/packages/GenPack/)
[![GitHub last commit](https://img.shields.io/github/last-commit/dimohy/GenPack?label=updated)](https://github.com/dimohy/GenPack)
![GitHub Repo stars](https://img.shields.io/github/stars/dimohy/GenPack?style=social)

## Details

### Info
:::info

Name: **GenPack**

Packet generation and serialization/deserialization library using the .NET Source Generator

Author: dimohy

NuGet: 
*https://www.nuget.org/packages/GenPack/*   


You can find more details at https://github.com/dimohy/GenPack

Source: https://github.com/dimohy/GenPack

:::

### Original Readme
:::note



# GenPack
[![latest version](https://img.shields.io/nuget/v/GenPack)](https://www.nuget.org/packages/GenPack)
[![downloads](https://img.shields.io/nuget/dt/GenPack)](https://www.nuget.org/packages/GenPack)

GenPack is a library that uses the .NET source generator to automatically generate packets as classes once you define a schema for the packets.
It's easy to use and the results are useful.

GenPack also works well with Native AOT. You can take advantage of the benefits of Native AOT.

## Simple to use
```csharp
[GenPackable]
public partial record PeoplePacket
{
    public readonly static PacketSchema Schema = PacketSchemaBuilder.Create()
        .@short("Age", "Age description")
        .@string("Name", "Name description")
        .Build();
}
```

The following code is automatically generated by the schema information.

```csharp
    public partial record PeoplePacket : GenPack.IGenPackable
    {
        /// <summary>
        /// Age description
        /// </summary>
        public short Age { get; set; }
        /// <summary>
        /// Name description
        /// </summary>
        public string Name { get; set; } = string.Empty;
        public byte[] ToPacket()
        {
            using var ms = new System.IO.MemoryStream();
            ToPacket(ms);
            return ms.ToArray();
        }
        public void ToPacket(System.IO.Stream stream)
        {
            System.IO.BinaryWriter writer = new System.IO.BinaryWriter(stream);
            writer.Write(Age);
            writer.Write(Name);
        }
        public static PeoplePacket FromPacket(byte[] data)
        {
            using var ms = new System.IO.MemoryStream(data);
            return FromPacket(ms);
        }
        public static PeoplePacket FromPacket(System.IO.Stream stream)
        {
            PeoplePacket result = new PeoplePacket();
            System.IO.BinaryReader reader = new System.IO.BinaryReader(stream);
            int size = 0;
            byte[] buffer = null;
            result.Age = reader.ReadInt16();
            result.Name = reader.ReadString();
            return result;
        }
    }
```

It's simple to use. You can binary serialize with `ToPacket()` and deserialize with `FromPacket()`.

```csharp
var p = new PeoplePacket()
{
    Age = 10,
    Name = "John"
};
var data = p.ToPacket();
var newP = PeoplePacket.FromPacket(data);

Console.WriteLine(newP);
```

```shell
PeoplePacket { Age = 10, Name = John }
```

## How to create a packet schema
Decorate the attribute of `class` or `record` with `GenPackable`. At this point, the target must be given `partial`.
GenPack's packet schema is represented by creating a `PacketSchema` using the `PacketSchemaBuilder`.

```csharp
[GenPackable]
public partial record PeoplePacket
{
    public readonly static PacketSchema Schema = PacketSchemaBuilder.Create()
        .@short("Age", "Age description")
        .@string("Name", "Name description")
        .Build();
}
```

The format beginning with `@` means the schema property to be created. For example, `@short("Age", "Age description")` gives the `Age` property the type `short` and the description `Age description`.
This translates to the following,

```csharp
        /// <summary>
        /// Age description
        /// </summary>
        public short Age { get; set; }
```
You can then use the auto-generated properties.

```csharp
var p = new PeoplePacket()
p.Age = 32;
```

### Schema Properties
| Property        | Description         | Bits | Arguments                        |
|-----------------|---------------------|------|----------------------------------|
| @byte           | byte                |   8  | property name, description       |
| @sbyte          | signed byte           |   8  | property name, description       |
| @short          | short int           |  16  | property name, description       |
| @ushort         | unsigned short int  |  16  | property name, description       |
| @int            | int                 |  32  | property name, description       |
| @uint           | unsigned int        |  32  | property name, description       |
| @long           | long int            |  64  | property name, description       |
| @ulong          | unsigned long int   |  64  | property name, description       |
| @float          | single float        |  32  | property name, description       |
| @double         | double float        |  64  | property name, description       |
| @string         | string              |   N  | property name, description       |
| @object\<type\> | genpackable object  |   N  | property name, description       |
| @list\<type\>   | variable list       |   N  | property name, description       |
| @dict\<type\>   | variable dictionary |   N  | property name, description       |
| @array\<type\>  | fixed array         |   N  | property name, size, description |

## Tasks
- [ ] Support for Endian, string Encoding.
- [ ] Support for checksums.
- [ ] Support 8-bit, 16-bit, 32-bit, 64-bit, or variable 7-bit sizes for `@list` and `@dict`.
- [ ] Add `@ver` property to allow revision control of packets.
- [ ] Automatically select and deserialize target structures based on packet command(identification code).
- [ ] Generate JSON and gRPC schema with `PacketSchema`.
- [ ] Process device packets with uncomplicated packet structures.
- [ ] Process structures with complex packets, such as PLCs.
- [ ] Process packets that require speed, such as `MemoryPack`.

------



[Icon creator: Freepik - Flaticon](https://www.flaticon.com/kr/free-icon/blocks_2021305)


:::

### About
:::note

Generating Binary Serialization and properties for class


:::

## How to use

### Example (source csproj, source files)

<Tabs>

<TabItem value="csproj" label="CSharp Project">

This is the CSharp Project that references **GenPack**
```xml showLineNumbers {10}
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>net9.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
  </PropertyGroup>
	<ItemGroup>
		<PackageReference Include="GenPack" Version=" 0.9.0-preview1" OutputItemType="Analyzer" ReferenceOutputAssembly="true" />
	</ItemGroup>
	<PropertyGroup>
		<EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>
		<CompilerGeneratedFilesOutputPath>$(BaseIntermediateOutputPath)\GX</CompilerGeneratedFilesOutputPath>
	</PropertyGroup>
</Project>

```

</TabItem>

  <TabItem value="D:\gth\RSCG_Examples\v2\rscg_examples\GenPack\src\Serializer\Program.cs" label="Program.cs" >

  This is the use of **GenPack** in *Program.cs*

```csharp showLineNumbers 
using SerializerDemo;

var p= new Person() { Name= "Andrei Ignat" };
var bytes= p.ToPacket();
var entity = Person.FromPacket(bytes);
Console.WriteLine("name is "+entity.Name);
```
  </TabItem>

  <TabItem value="D:\gth\RSCG_Examples\v2\rscg_examples\GenPack\src\Serializer\Person.cs" label="Person.cs" >

  This is the use of **GenPack** in *Person.cs*

```csharp showLineNumbers 

using GenPack;

namespace SerializerDemo;


[GenPackable]
public partial record Person
{

    public readonly static PacketSchema Schema = PacketSchemaBuilder.Create()
           .@short("Id", "Age description")
           .@string("Name", "Name description")
           .Build();
}


```
  </TabItem>

</Tabs>

### Generated Files

Those are taken from $(BaseIntermediateOutputPath)\GX

<Tabs>


<TabItem value="D:\gth\RSCG_Examples\v2\rscg_examples\GenPack\src\Serializer\obj\GX\GenPack.SourceGenerator\GenPack.GenPackGenerator\PersonSchema.g.cs" label="PersonSchema.g.cs" >


```csharp showLineNumbers 
#pragma warning disable CS0219
namespace SerializerDemo
{
    public partial record Person : GenPack.IGenPackable
    {
        /// <summary>
        /// Age description
        /// </summary>
        public short Id { get; set; }
        /// <summary>
        /// Name description
        /// </summary>
        public string Name { get; set; } = string.Empty;
        public byte[] ToPacket()
        {
            using var ms = new System.IO.MemoryStream();
            ToPacket(ms);
            return ms.ToArray();
        }
        public void ToPacket(System.IO.Stream stream)
        {
            System.IO.BinaryWriter writer = new System.IO.BinaryWriter(stream);
            writer.Write(Id);
            writer.Write(Name);
        }
        public static SerializerDemo.Person FromPacket(byte[] data)
        {
            using var ms = new System.IO.MemoryStream(data);
            return FromPacket(ms);
        }
        public static SerializerDemo.Person FromPacket(System.IO.Stream stream)
        {
            SerializerDemo.Person result = new SerializerDemo.Person();
            System.IO.BinaryReader reader = new System.IO.BinaryReader(stream);
            int size = 0;
            byte[] buffer = null;
            result.Id = reader.ReadInt16();
            result.Name = reader.ReadString();
            return result;
        }
    }
}

```

  </TabItem>


</Tabs>

## Useful

### Download Example (.NET  C#)

:::tip

[Download Example project GenPack ](/sources/GenPack.zip)

:::


### Share GenPack 

<ul>
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FGenPack&quote=GenPack" title="Share on Facebook" target="_blank">Share on Facebook</a></li>
  <li><a href="https://twitter.com/intent/tweet?source=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FGenPack&text=GenPack:%20https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FGenPack" target="_blank" title="Tweet">Share in Twitter</a></li>
  <li><a href="http://www.reddit.com/submit?url=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FGenPack&title=GenPack" target="_blank" title="Submit to Reddit">Share on Reddit</a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FGenPack&title=GenPack&summary=&source=https%3A%2F%2Fignatandrei.github.io%2FRSCG_Examples%2Fv2%2Fdocs%2FGenPack" target="_blank" title="Share on LinkedIn">Share on Linkedin</a></li>
</ul>

https://ignatandrei.github.io/RSCG_Examples/v2/docs/GenPack

aaa
<SameCategory />

